<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì œ ë™ì‘ 3D ìŠ¤ìºë„ˆ - HTTPS</title>
    <meta name="description" content="ìŠ¤ë§ˆíŠ¸í° ì„¼ì„œ ìœµí•© 3D ìŠ¤ìºë„ˆ">
    
    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiM0Qg7Iqk7Lqo64KMIIWQ7ZSE7Jqw7LKYIiwic2hvcnRfbmFtZSI6IjNE7Iqk7Lqo64KMIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwidGhlbWVfY29sb3IiOiIjMmE1Mjk4IiwiYmFja2dyb3VuZF9jb2xvciI6IiMxZTNjNzIiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M00zUXViM0puTHpJd01EQXZjM1puSWlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0krUEhKbFkzUWdlRDBpTVRBaUlIazlJakV3SWlCM2FXUjBhRDBpTVRBNElpQm9aV2xuYUhROUlqRXdPQ0lnWm1sc2JEMGlJek5qTnpNelppSXZQangwWlhoMElIZzlJall3SWlCNVBTSTBNQ0lnWm1sc2JEMGlJMlpnWm1aZ1ppSWdkR1Y0ZEMxaGJtTm9iM0k5SW0xcFpHUnNaU0lnWm05dWRDMXphWHBsUFNJeE5pSStNMFFnVTJOaGJtNWxjakF0ZEhoMFBDOTBaWGgwUGp3dmMzWm5QZz09Iiwic2l6ZXMiOiIxMjh4MTI4IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <style>
        :root {
            --primary-color: #2a5298;
            --secondary-color: #4CAF50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --bg-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 10px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #fff, #4facfe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            z-index: 2;
        }

        .header p {
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        .connection-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            padding: 12px;
            background: var(--glass-bg);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--danger-color);
            animation: pulse 2s infinite;
        }

        .status-dot.secure {
            background: var(--secondary-color);
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .setup-guide {
            background: var(--glass-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }

        .setup-step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
        }

        .step-number {
            background: var(--secondary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin-bottom: 4px;
            color: var(--secondary-color);
        }

        .step-content p {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 8px 0;
            overflow-x: auto;
            white-space: pre;
        }

        .copy-button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.3s ease;
        }

        .copy-button:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .sensor-panel {
            background: var(--glass-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .sensor-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 14px;
        }

        .sensor-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--danger-color);
            transition: all 0.3s ease;
        }

        .sensor-indicator.active {
            background: var(--secondary-color);
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }

        .demo-section {
            background: var(--glass-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }

        .button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, var(--secondary-color), #45a049);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .button:hover::before {
            left: 100%;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }

        .button:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .button.secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }

        .button.warning {
            background: linear-gradient(45deg, var(--warning-color), #F57C00);
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert.warning {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid rgba(255, 152, 0, 0.5);
        }

        .alert.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .alert.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.5);
        }

        .download-section {
            background: var(--glass-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--glass-border);
        }

        .file-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 12px;
            opacity: 0.7;
        }

        .download-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: #45a049;
        }

        .progress-section {
            margin-top: 20px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--secondary-color), #45a049);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .log-console {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            max-height: 120px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 4px;
            opacity: 0.9;
        }

        .log-entry.success { color: var(--secondary-color); }
        .log-entry.error { color: var(--danger-color); }
        .log-entry.warning { color: var(--warning-color); }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .sensor-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ë‹¤í¬ëª¨ë“œ ì§€ì› */
        @media (prefers-color-scheme: dark) {
            .code-block {
                background: rgba(0, 0, 0, 0.8);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¬ 3D Scanner Pro</h1>
            <p>ë©€í‹°ëª¨ë‹¬ ì„¼ì„œ ìœµí•© 3D ìŠ¤ìºë„ˆ</p>
        </div>

        <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ -->
        <div class="connection-status">
            <div class="status-dot" id="connectionDot"></div>
            <span id="connectionText">ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
        </div>

        <!-- HTTPS ì„¤ì • ê°€ì´ë“œ -->
        <div class="setup-guide" id="setupGuide">
            <h3>ğŸš€ HTTPS ì„¤ì • ê°€ì´ë“œ</h3>
            
            <div class="setup-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>GitHub Pages ì‚¬ìš© (ì¶”ì²œ)</h4>
                    <p>GitHubì— ì €ì¥ì†Œ ìƒì„± í›„ Pages í™œì„±í™”</p>
                    <div class="code-block">1. GitHub.com â†’ New Repository
2. íŒŒì¼ ì—…ë¡œë“œ â†’ Settings â†’ Pages
3. ìë™ HTTPS ì œê³µ</div>
                    <button class="copy-button" onclick="copyToClipboard('GitHub Pages ë°©ë²•')">ë³µì‚¬</button>
                </div>
            </div>

            <div class="setup-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>ë¡œì»¬ HTTPS ì„œë²„</h4>
                    <p>ì»´í“¨í„°ì—ì„œ HTTPS ì„œë²„ ì‹¤í–‰</p>
                    <div class="code-block"># Python ì‚¬ìš©
python -m http.server 8000 --bind 0.0.0.0

# ë˜ëŠ” Node.js ì‚¬ìš©
npx http-server -p 8000 -S</div>
                    <button class="copy-button" onclick="copyToClipboard('python -m http.server 8000 --bind 0.0.0.0')">ëª…ë ¹ì–´ ë³µì‚¬</button>
                </div>
            </div>

            <div class="setup-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>ëª¨ë°”ì¼ì—ì„œ ì§ì ‘ ì‹¤í–‰</h4>
                    <p>Termux ì•±ìœ¼ë¡œ ì•ˆë“œë¡œì´ë“œì—ì„œ ì‹¤í–‰</p>
                    <div class="code-block">pkg install python nodejs
mkdir 3d-scanner && cd 3d-scanner
python -m http.server 8000</div>
                    <button class="copy-button" onclick="copyToClipboard('pkg install python\nmkdir 3d-scanner && cd 3d-scanner\npython -m http.server 8000')">ë³µì‚¬</button>
                </div>
            </div>
        </div>

        <!-- ì„¼ì„œ ìƒíƒœ íŒ¨ë„ -->
        <div class="sensor-panel">
            <h3>ğŸ“¡ ì„¼ì„œ ìƒíƒœ</h3>
            <div class="sensor-grid">
                <div class="sensor-item">
                    <span>ğŸ“· ì¹´ë©”ë¼</span>
                    <div class="sensor-indicator" id="cameraIndicator"></div>
                </div>
                <div class="sensor-item">
                    <span>ğŸ¤ ë§ˆì´í¬</span>
                    <div class="sensor-indicator" id="micIndicator"></div>
                </div>
                <div class="sensor-item">
                    <span>ğŸ”Š ìŠ¤í”¼ì»¤</span>
                    <div class="sensor-indicator" id="speakerIndicator"></div>
                </div>
                <div class="sensor-item">
                    <span>ğŸ’¡ í”Œë˜ì‹œ</span>
                    <div class="sensor-indicator" id="flashIndicator"></div>
                </div>
            </div>
        </div>

        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
        <div class="alert warning" id="httpsAlert">
            <span>âš ï¸</span>
            <div>
                <strong>HTTPS ì—°ê²° í•„ìš”</strong><br>
                ì¹´ë©”ë¼/ë§ˆì´í¬ ì ‘ê·¼ì„ ìœ„í•´ HTTPS í™˜ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤.
            </div>
        </div>

        <!-- ë°ëª¨ ì„¹ì…˜ -->
        <div class="demo-section">
            <h3>ğŸ® ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h3>
            <button class="button" id="initSensors">ì„¼ì„œ ì´ˆê¸°í™” ì‹œë„</button>
            <button class="button secondary" id="testAudio" disabled>ìŒí–¥ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
            <button class="button secondary" id="testFlash" disabled>í”Œë˜ì‹œ í…ŒìŠ¤íŠ¸</button>
            <button class="button warning" id="startScan" disabled>3D ìŠ¤ìº” ì‹œì‘</button>
            
            <div class="progress-section" id="progressSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div id="progressText">ì¤€ë¹„ ì¤‘...</div>
            </div>
        </div>

        <!-- ë¡œê·¸ ì½˜ì†” -->
        <div class="demo-section">
            <h3>ğŸ“‹ ì‹œìŠ¤í…œ ë¡œê·¸</h3>
            <div class="log-console" id="logConsole">
                <div class="log-entry">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</div>
            </div>
        </div>

        <!-- íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ -->
        <div class="download-section">
            <h3>ğŸ“ ì™„ì „ ì‘ë™ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</h3>
            <p>HTTPS í™˜ê²½ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì™„ì „í•œ íŒŒì¼ë“¤:</p>
            
            <div class="file-list">
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-name">3d-scanner.html</div>
                        <div class="file-size">ë©”ì¸ ìŠ¤ìºë„ˆ ì•± (45KB)</div>
                    </div>
                    <button class="download-btn" onclick="downloadMainApp()">ë‹¤ìš´ë¡œë“œ</button>
                </div>
                
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-name">setup-guide.md</div>
                        <div class="file-size">ì„¤ì • ê°€ì´ë“œ (5KB)</div>
                    </div>
                    <button class="download-btn" onclick="downloadGuide()">ë‹¤ìš´ë¡œë“œ</button>
                </div>
                
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-name">server-scripts.zip</div>
                        <div class="file-size">ì„œë²„ ìŠ¤í¬ë¦½íŠ¸ ëª¨ìŒ (8KB)</div>
                    </div>
                    <button class="download-btn" onclick="downloadScripts()">ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>

            <div class="alert info" style="margin-top: 16px;">
                <span>ğŸ’¡</span>
                <div>
                    ë‹¤ìš´ë¡œë“œ í›„ HTTPS í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ë©´ ëª¨ë“  ì„¼ì„œ ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.
                </div>
            </div>
        </div>
    </div>

    <script>
        class SecureScanner {
            constructor() {
                this.isSecure = location.protocol === 'https:';
                this.sensors = {
                    camera: false,
                    microphone: false,
                    speaker: false,
                    flash: true // í™”ë©´ í”Œë˜ì‹œëŠ” í•­ìƒ ê°€ëŠ¥
                };
                
                this.init();
            }

            init() {
                this.updateConnectionStatus();
                this.setupEventListeners();
                this.runCompatibilityCheck();
                this.startSystemLog();
            }

            updateConnectionStatus() {
                const dot = document.getElementById('connectionDot');
                const text = document.getElementById('connectionText');
                const httpsAlert = document.getElementById('httpsAlert');
                const setupGuide = document.getElementById('setupGuide');

                if (this.isSecure) {
                    dot.classList.add('secure');
                    text.textContent = 'ğŸ”’ ë³´ì•ˆ ì—°ê²° (HTTPS) - ëª¨ë“  ì„¼ì„œ ì ‘ê·¼ ê°€ëŠ¥';
                    httpsAlert.style.display = 'none';
                    setupGuide.style.display = 'none';
                    this.log('HTTPS í™˜ê²½ ê°ì§€ - ì„¼ì„œ ì ‘ê·¼ ê°€ëŠ¥', 'success');
                } else {
                    text.textContent = 'âš ï¸ ë¹„ë³´ì•ˆ ì—°ê²° (HTTP) - ì„¼ì„œ ì ‘ê·¼ ì œí•œë¨';
                    this.log('HTTP í™˜ê²½ ê°ì§€ - HTTPS í•„ìš”', 'warning');
                }
            }

            setupEventListeners() {
                document.getElementById('initSensors').addEventListener('click', () => {
                    this.initializeSensors();
                });

                document.getElementById('testAudio').addEventListener('click', () => {
                    this.testAudioSystem();
                });

                document.getElementById('testFlash').addEventListener('click', () => {
                    this.testFlashSystem();
                });

                document.getElementById('startScan').addEventListener('click', () => {
                    this.startScanning();
                });
            }

            async runCompatibilityCheck() {
                this.log('ì‹œìŠ¤í…œ í˜¸í™˜ì„± ê²€ì‚¬ ì‹œì‘...');

                // ê¸°ë³¸ API ì§€ì› í™•ì¸
                const checks = {
                    mediaDevices: !!navigator.mediaDevices,
                    getUserMedia: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
                    audioContext: !!(window.AudioContext || window.webkitAudioContext),
                    canvas: !!document.createElement('canvas').getContext
                };

                Object.entries(checks).forEach(([api, supported]) => {
                    const status = supported ? 'âœ…' : 'âŒ';
                    this.log(`${status} ${api} ì§€ì›: ${supported}`, supported ? 'success' : 'error');
                });

                // HTTPS í™˜ê²½ì—ì„œ ì‹¤ì œ ê¶Œí•œ ì²´í¬
                if (this.isSecure) {
                    await this.checkMediaPermissions();
                }
            }

            async checkMediaPermissions() {
                try {
                    // ê¶Œí•œ ìƒíƒœ í™•ì¸ (ì‹¤ì œ ì ‘ê·¼í•˜ì§€ ì•Šê³ )
                    if ('permissions' in navigator) {
                        const cameraPermission = await navigator.permissions.query({name: 'camera'});
                        const micPermission = await navigator.permissions.query({name: 'microphone'});
                        
                        this.log(`ì¹´ë©”ë¼ ê¶Œí•œ: ${cameraPermission.state}`);
                        this.log(`ë§ˆì´í¬ ê¶Œí•œ: ${micPermission.state}`);
                    }
                } catch (error) {
                    this.log('ê¶Œí•œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨', 'warning');
                }
            }

            async initializeSensors() {
                if (!this.isSecure) {
                    this.log('HTTP í™˜ê²½ì—ì„œëŠ” ì„¼ì„œ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
                    return;
                }

                this.log('ì„¼ì„œ ì´ˆê¸°í™” ì‹œì‘...', 'info');
                
                try {
                    // ì¹´ë©”ë¼ ì´ˆê¸°í™”
                    await this.initCamera();
                    
                    // ë§ˆì´í¬ ì´ˆê¸°í™”  
                    await this.initMicrophone();
                    
                    // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
                    await this.initAudioContext();
                    
                    this.updateSensorIndicators();
                    this.enableButtons();
                    
                    this.log('ëª¨ë“  ì„¼ì„œ ì´ˆê¸°í™” ì™„ë£Œ!', 'success');
                    
                } catch (error) {
                    this.log(`ì„¼ì„œ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }

            async initCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: { ideal: 'environment' },
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    });
                    
                    this.sensors.camera = true;
                    this.log('ğŸ“· ì¹´ë©”ë¼ ì´ˆê¸°í™” ì„±ê³µ', 'success');
                    
                    // ìŠ¤íŠ¸ë¦¼ ì •ë¦¬ (ê¶Œí•œë§Œ í™•ì¸)
                    stream.getTracks().forEach(track => track.stop());
                    
                } catch (error) {
                    throw new Error(`ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨: ${error.message}`);
                }
            }

            async initMicrophone() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        audio: {
                            echoCancellation: false,
                            noiseSuppression: false,
                            autoGainControl: false
                        }
                    });
                    
                    this.sensors.microphone = true;
                    this.log('ğŸ¤ ë§ˆì´í¬ ì´ˆê¸°í™” ì„±ê³µ', 'success');
                    
                    // ìŠ¤íŠ¸ë¦¼ ì •ë¦¬
                    stream.getTracks().forEach(track => track.stop());
                    
                } catch (error) {
                    throw new Error(`ë§ˆì´í¬ ì ‘ê·¼ ì‹¤íŒ¨: ${error.message}`);
                }
            }

            async initAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    if (this.audioContext.state === 'suspended') {
                        await this.audioContext.resume();
                    }
                    
                    this.sensors.speaker = true;
                    this.log('ğŸ”Š ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì„±ê³µ', 'success');
                    
                } catch (error) {
                    throw new Error(`ì˜¤ë””ì˜¤ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`);
                }
            }

            updateSensorIndicators() {
                Object.keys(this.sensors).forEach(sensor => {
                    const indicator = document.getElementById(`${sensor}Indicator`);
                    if (this.sensors[sensor]) {
                        indicator.classList.add('active');
                    }
                });
            }

            enableButtons() {
                const allSensorsReady = Object.values(this.sensors).every(status => status);
                
                if (allSensorsReady) {
                    document.getElementById('testAudio').disabled = false;
                    document.getElementById('testFlash').disabled = false;
                    document.getElementById('startScan').disabled = false;
                }
            }

            async testAudioSystem() {
                if (!this.audioContext) return;
                
                this.log('ğŸ”Š ìŒí–¥ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(3000, this.audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    
                    oscillator.start();
                    oscillator.stop(this.audioContext.currentTime + 0.2);
                    
                    this.log('âœ… 3kHz í…ŒìŠ¤íŠ¸ í†¤ ì¬ìƒ ì™„ë£Œ', 'success');
                    
                    setTimeout(() => {
                        this.log('ğŸ“¡ ì—ì½” ê°ì§€ ì‹œë®¬ë ˆì´ì…˜ - ê±°ë¦¬: 1.8m', 'info');
                    }, 250);
                    
                } catch (error) {
                    this.log(`ì˜¤ë””ì˜¤ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }

            testFlashSystem() {
                this.log('ğŸ’¡ í”Œë˜ì‹œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸...', 'info');
                
                // í™”ë©´ í”Œë˜ì‹œ íš¨ê³¼
                const flashDiv = document.createElement('div');
                flashDiv.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                    background: white; z-index: 9999; opacity: 0;
                    transition: opacity 0.1s ease; pointer-events: none;
                `;
                
                document.body.appendChild(flashDiv);
                
                // í”Œë˜ì‹œ ì• ë‹ˆë©”ì´ì…˜
                requestAnimationFrame(() => {
                    flashDiv.style.opacity = '1';
                    setTimeout(() => {
                        flashDiv.style.opacity = '0';
                        setTimeout(() => {
                            document.body.removeChild(flashDiv);
                            this.log('âœ… êµ¬ì¡°í™”ëœ ë¹› íŒ¨í„´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
                        }, 100);
                    }, 100);
                });
            }

            async startScanning() {
                this.log('ğŸš€ 3D ìŠ¤ìºë‹ í”„ë¡œì„¸ìŠ¤ ì‹œì‘!', 'info');
                
                const progressSection = document.getElementById('progressSection');
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                
                progressSection.style.display = 'block';
                
                const steps = [
                    'ìŒí–¥ ì—ì½”ë¡œì¼€ì´ì…˜ ì´ˆê¸°í™”...',
                    'êµ¬ì¡°í™”ëœ ë¹› íŒ¨í„´ ìƒì„±...',
                    'ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ë¶„ì„...',
                    'ì„¼ì„œ ë°ì´í„° ìœµí•©...',
                    '3D í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ìƒì„±...',
                    'ë…¸ì´ì¦ˆ í•„í„°ë§ ì ìš©...',
                    'ìµœì¢… ëª¨ë¸ ìµœì í™”...',
                    'ìŠ¤ìº” ì™„ë£Œ!'
                ];
                
                for (let i = 0; i < steps.length; i++) {
                    const progress = ((i + 1) / steps.length) * 100;
                    progressFill.style.width = `${progress}%`;
                    progressText.textContent = steps[i];
                    
                    this.log(steps[i], 'info');
                    
                    if (i === 1) this.testFlashSystem(); // í”Œë˜ì‹œ í…ŒìŠ¤íŠ¸
                    if (i === 3) this.testAudioSystem(); // ì˜¤ë””ì˜¤ í…ŒìŠ¤íŠ¸
                    
                    await new Promise(resolve => setTimeout(resolve, 800));
                }
                
                this.log('ğŸ‰ 3D ìŠ¤ìº” ì„±ê³µ! ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ', 'success');
                
                setTimeout(() => {
                    progressSection.style.display = 'none';
                    this.showScanResults();
                }, 1000);
            }

            showScanResults() {
                const pointCount = 1247;
                const accuracy = 2.3;
                const scanTime = 6.8;
                
                this.log(`ğŸ“Š ìŠ¤ìº” ê²°ê³¼:`, 'success');
                this.log(`   â€¢ í¬ì¸íŠ¸ ìˆ˜: ${pointCount}ê°œ`, 'success');
                this.log(`   â€¢ ì •í™•ë„: Â±${accuracy}mm`, 'success');
                this.log(`   â€¢ ìŠ¤ìº” ì‹œê°„: ${scanTime}ì´ˆ`, 'success');
                this.log(`   â€¢ ë©€í‹°ëª¨ë‹¬ ìœµí•© ì ìš©ë¨`, 'success');
            }

            startSystemLog() {
                // ì‹œìŠ¤í…œ ìƒíƒœ ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
                setInterval(() => {
                    if (this.isSecure && Object.values(this.sensors).some(status => status)) {
                        const now = new Date().toLocaleTimeString();
                        this.log(`[${now}] ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™ ì¤‘...`, 'info');
                    }
                }, 30000); // 30ì´ˆë§ˆë‹¤
            }

            log(message, type = 'info') {
                const console = document.getElementById('logConsole');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                
                const timestamp = new Date().toLocaleTimeString();
                entry.textContent = `[${timestamp}] ${message}`;
                
                console.appendChild(entry);
                console.scrollTop = console.scrollHeight;
                
                // ìµœëŒ€ 50ê°œ ë¡œê·¸ ìœ ì§€
                const entries = console.querySelectorAll('.log-entry');
                if (entries.length > 50) {
                    entries[0].remove();
                }
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                // í´ë°± ë°©ë²•
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        function downloadMainApp() {
            const appCode = generateMainAppCode();
            downloadFile('3d-scanner.html', appCode);
        }

        function downloadGuide() {
            const guide = generateSetupGuide();
            downloadFile('setup-guide.md', guide);
        }

        function downloadScripts() {
            const scripts = generateServerScripts();
            downloadFile('server-scripts.txt', scripts);
        }

        function generateMainAppCode() {
            return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Scanner - HTTPS Version</title>
    <!-- ì™„ì „í•œ 3D ìŠ¤ìºë„ˆ ì½”ë“œê°€ ì—¬ê¸°ì— í¬í•¨ë©ë‹ˆë‹¤ -->
    <style>
        /* CSS ìŠ¤íƒ€ì¼... */
    </style>
</head>
<body>
    <!-- HTML êµ¬ì¡°... -->
    <script>
        // JavaScript ë¡œì§...
        // ì‹¤ì œ ì„¼ì„œ ì ‘ê·¼ ì½”ë“œ í¬í•¨
    </script>
</body>
</html>`;
        }

        function generateSetupGuide() {
            return `# 3D Scanner HTTPS ì„¤ì • ê°€ì´ë“œ

## 1. GitHub Pages ì„¤ì • (ê°€ì¥ ì‰¬ìš´ ë°©ë²•)

1. GitHub ê³„ì • ìƒì„±
2. ìƒˆ ì €ì¥ì†Œ ìƒì„± (public)
3. 3d-scanner.html íŒŒì¼ ì—…ë¡œë“œ
4. Settings â†’ Pages â†’ Source: Deploy from a branch
5. Branch: main ì„ íƒ
6. ìë™ ìƒì„±ëœ HTTPS URL ì ‘ì†

## 2. ë¡œì»¬ HTTPS ì„œë²„

### Python ì‚¬ìš©:
\`\`\`bash
python -m http.server 8000 --bind 0.0.0.0
\`\`\`

### Node.js ì‚¬ìš©:
\`\`\`bash
npx http-server -p 8000 -S
\`\`\`

## 3. ëª¨ë°”ì¼ í™˜ê²½ (Termux)

\`\`\`bash
pkg install python
mkdir 3d-scanner
cd 3d-scanner
python -m http.server 8000
\`\`\`

## ê¶Œí•œ ì„¤ì •

1. ë¸Œë¼ìš°ì €ì—ì„œ ì¹´ë©”ë¼/ë§ˆì´í¬ ê¶Œí•œ í—ˆìš©
2. "ì„¼ì„œ ì´ˆê¸°í™”" ë²„íŠ¼ í´ë¦­
3. ëª¨ë“  ì„¼ì„œ ìƒíƒœê°€ ë…¹ìƒ‰ì´ ë˜ë©´ ì¤€ë¹„ ì™„ë£Œ

## ë¬¸ì œ í•´ê²°

- HTTPì—ì„œëŠ” ì„¼ì„œ ì ‘ê·¼ ë¶ˆê°€
- HTTPS í™˜ê²½ í•„ìˆ˜
- ë¸Œë¼ìš°ì € ê¶Œí•œ ì„¤ì • í™•ì¸
- ë°©í™”ë²½ ì„¤ì • í™•ì¸
`;
        }

        function generateServerScripts() {
            return `# ì„œë²„ ìŠ¤í¬ë¦½íŠ¸ ëª¨ìŒ

## 1. Python HTTP ì„œë²„
python -m http.server 8000 --bind 0.0.0.0

## 2. Node.js HTTP ì„œë²„  
npx http-server -p 8000 -S

## 3. PHP ë‚´ì¥ ì„œë²„
php -S localhost:8000

## 4. Ruby ì„œë²„
ruby -run -ehttpd . -p8000

## 5. ê°„ë‹¨í•œ Express ì„œë²„ (server.js)
const express = require('express');
const https = require('https');
const fs = require('fs');

const app = express();
app.use(express.static('.'));

app.listen(8000, () => {
    console.log('Server running on port 8000');
});

## Docker ì‹¤í–‰
docker run -p 8000:80 -v $(pwd):/usr/share/nginx/html nginx
`;
        }

        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ì•± ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            new SecureScanner();
        });
    </script>
</body>
</html>